<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메뉴 추가</title>

    <link href="/resources/css/common.css" rel="stylesheet" type="text/css" />
    <link href="/resources/css/style.css"  rel="stylesheet" type="text/css"  />
    <link href="/resources/css/miaps.css"  rel="stylesheet" type="text/css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    
</head>
<body>
    <header>
        <button class="back_btn"></button><span class="title">메뉴 추가</span>
      </header>
      <div class="contents_wrap">
   
        <ul class="field_wrap">
         
            <li><span>음식점명</span>
              <input type="text" id="restaurant" name="nm" />
            </li>
            <li><span>주소</span>
                <textarea id="address" name="addr" ></textarea>
            </li>
            <li><span>종류</span>
                <select id="typeName"></select>
            </li>
            
        </ul>
        <button type="button" class="bottom_btn" id="btn_save">저장</button>
       
    </div>

    <script type="text/javascript" src="/resources/js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="/resources/js/handlebars-4.0.11.js"></script>
    <script type="text/javascript" src="/resources/js/common.js"></script>
    
    <script id="selectMenuType" type="text/x-handlebars-template">
      {{#menuType}}
      <option value="{{menuType}}">{{menuName}}</option>
      {{/menuType}}
    </script>

    <script type="text/javascript">

      $(function(){
        var callback = ajaxConnect('GET', 'getMenuType', '');
        //alert(JSON.stringify(callback));
        if(callback.data != undefined) {
          var obj = callback.data;
          var source = $("#selectMenuType").html();
          var template = Handlebars.compile(source);
          var res = {
              menuType : obj.data
          };
    
          var html = template(res);
          console.log(html)
          $("#typeName").append(html);
        }
      });
      
      $('#btn_save').on('click', function(){
         var p_address = $('#address').val();
         var p_name = $('#restaurant').val();
         var p_type = $('#typeName').val();
        
         if(p_address == '' || p_name == '' || p_type == '') {
            alert('내용을 입력해주세요.');
            return;
         }

         var addMenuData = {};
         addMenuData = {"location" : p_address, "menuType" : p_type, "name" : p_name};
        
         var msg = "메뉴를 추가하시겠습니까?";
            if (confirm(msg)!=0) {
                 // Yes click
                 var callback = ajaxConnect('POST', 'addMenu', addMenuData);
                 console.log(JSON.stringify(callback));
                 console.log(callback.xhr)
                 if(callback.xhr == '204') {
                    alert('메뉴가 추가되었습니다.');
                 } else if(callback.error !== undefined) {
                    alert(callback.errMsg);
                 }
    
            } else {
                // no click
            }
        
      });

        // 58.181.28.53:11199/menu/getAllMenu(GET) // addMenu(POST)
    
      //좌측 상단 뒤로가기 버튼
      $('.back_btn').on('click', function(){
        window.history.back();
      });
    </script>

    
</body>
</html>
