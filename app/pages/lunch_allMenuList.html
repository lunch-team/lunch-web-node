<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main.html</title>

    <link href="/resources/css/common.css" rel="stylesheet" type="text/css" />
    <link href="/resources/css/style.css"  rel="stylesheet" type="text/css"  />
    <link href="/resources/css/miaps.css"  rel="stylesheet" type="text/css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    
</head>
<body>
    <header>
        <button class="back_btn"></button><span class="title">메뉴목록</span>
      </header>
      <div class="contents_wrap" id="contents_list">
        <br />
        <br />
    </div>
      <script type="text/javascript" src="/resources/js/jquery-3.5.1.min.js"></script>
      <script type="text/javascript" src="/resources/js/handlebars-4.0.11.js"></script>
      
      <script id="menuList" type="text/x-handlebars-template">
        <!-- 컨텐츠영역 -->
      
            {{#menuList}}
            <div class="round_box" name="food_box" data-food_name="{{name}}" data-food_location="{{location}}"
                 data-food_menutype="{{menuType}}" data-food_id="{{id}}">
              <p class="req_title" >
               {{name}}
               <input type="checkbox" checked>
              </p>
              <div class="req_dt_wrap">
                <span class="req_dt" >
                 {{location}}
                </span>
                <span class="status col5" >
                 {{menuType}}
                </span>
              </div>
            </div>
            {{/menuList}}
     
    </script>

    <script type="text/javascript">
      console.log('run!')

      var connectUrl = "http://58.181.28.53:11199/menu/";
			
			$.ajax({ 	
					type : 'GET',
					url: connectUrl + 'getAllMenu', 
					dataType : 'json' ,
					contentType : 'application/json',
					data : '',
					success: function(data) { //통신 성공
                      var obj = data;
                      console.log(obj); 
                      //템플릿 사용하여 리스트 만들기
                      var source = $("#menuList").html();
                      var template = Handlebars.compile(source);
                      var res = {
                          menuList : obj.data
                      };
    
				              var html = template(res);
                      console.log(html)
                      $("#contents_list").append(html);
				} });
        // 58.181.28.53:11199/menu/getAllMenu(GET) // addMenu(POST)
    
        $(document).on('click', 'div[name="food_box"]', function(e){
            e.preventDefault();
		        e.stopPropagation();
            
            var location = $(this).data('food_location');
            var name = $(this).data('food_name')
            var type = $(this).data('food_menutype')
            var id = $(this).data('food_id');
    
            window.location.href = 'lunch_menuDetail.html?name='+name+'&location='+location+'&id='+id+'&type='+type;
          //   var addParam = {};
          //   addParam = {"location" : location, "menuType" : type, "name" : name};
          //   console.log('addParam : ' + JSON.stringify(addParam))

          //   $.ajax({ 	
          //       type : 'POST',
          //       url: connectUrl + 'addMenu' , 
          //       dataType : 'json' ,
          //       contentType : 'application/json',
          //       data : JSON.stringify(addParam),
          //       success: function(data) { 
          //                     console.log(data);
          //                     //var obj = miaps.parse(data);
          //                     //console.log(obj.data);  
          //       },
          //       error: function(e) {
          //         //status == 409면 중복입니다
          //           console.error(e);
          //           console.error(e.responseJSON.errorMessage);
          //           console.error(e.status);

          //           if(e.status == 409) {
          //             alert('중복입니다.');
          //           }
          //       }
          //     });
            });

          //좌측 상단 뒤로가기 버튼
          $('.back_btn').on('click', function(){
            window.history.back();
          });
    </script>

    
</body>
</html>
