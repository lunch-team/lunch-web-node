<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>점심 뭐 먹지?</title>

    <link href="/resources/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/resources/css/style.css" rel="stylesheet" type="text/css"/>
    <link rel="preconnect" href="https://fonts.gstatic.com"/>

    <style>
        .clear {
            clear: both;
        }
        .btn-wrapper {
            float: right;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        
        .btn-wrapper button {
            font-size: 12px;
            color: #707070;
            float: left;
            border: 0;
            background-color: white;
            border-radius: 5px;
            width: 75px;
            height: 30px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
<header>
    <button class="back_btn"></button>
    <span class="title">메뉴목록</span>
</header>
<div class="contents_wrap">
    <div class="btn-wrapper">
        <button class="btn-order" data-order="abc">가나다</button>
        <button class="btn-order" data-order="recent">최근방문</button>
        <button class="btn-order" data-order="count">방문수</button>
    </div>
    <div class="clear"></div>
    <div class="list-wrap" id="contents_list"></div>
    <div class="loading-container" id="loading_container">
        <div class="loading"></div>
        <div id="loading-text">loading</div>
    </div>
</div>
<script type="text/javascript" src="/resources/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/resources/js/handlebars-4.0.11.js"></script>
<script type="text/javascript" src="/resources/js/common.js"></script>

<script id="menuList" type="text/x-handlebars-template">
    {{#menuList}}
    <div 
        class="round_box" 
        name="food_box" 
        data-food_name="{{name}}"
        data-food_location="{{location}}"
        data-food_menutype="{{menuType}}" 
        data-food_id="{{id}}"
    >
        <p class="req_title">
            {{name}}
            <span style="float: right; font-size: 13px; color: #707070; font-weight: 400;">
                {{visitCount}}회 방문
            </span>
        </p>
        <div class="req_dt_wrap">
            <span class="req_dt">
                {{location}}
            </span>
            <span class="req_dt">
                 {{menuName}}
            </span>
        </div>
    </div>
    {{/menuList}}
</script>

<script type="text/javascript">
    function getAllMenu(order) {
        $('.list-wrap').empty()
        $('#loading_container').show();
        var callback = ajaxConnect('POST', 'getAllMenu', {'orderType': order.toUpperCase()});
        if (callback.data !== undefined) {
            $('#loading_container').hide();
            var obj = callback.data;
            var source = $("#menuList").html();
            var template = Handlebars.compile(source);
            var res = {
                menuList: obj.data
            };

            $("#contents_list").html(template(res));
        } else if (callback.error !== undefined) {
            console.log(callback.error);
            alert(callback.errMsg);
        }
    }

    $(function () {
        localStorage.clear();
        $('#loading_container').hide();
        getAllMenu('ABC')
    });

    $(document).on('click', 'div[name="food_box"]', function (e) {
        e.preventDefault();
        e.stopPropagation();

        localStorage.setItem('name', $(this).data('food_name'))
        localStorage.setItem('location', $(this).data('food_location'))
        localStorage.setItem('type', $(this).data('food_menutype'))
        localStorage.setItem('id', $(this).data('food_id'))

        window.location.href = 'lunch_menuDetail.html';
    });

    // 정렬하여 다시 가져오기
    $('.btn-order').on('click', function () {
        getAllMenu($(this).data('order'))
    })

    //좌측 상단 뒤로가기 버튼
    $('.back_btn').on('click', function () {
        location.href = 'lunch_main.html';
    });
</script>


</body>
</html>
