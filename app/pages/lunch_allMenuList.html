<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main.html</title>

    <link href="/resources/css/common.css" rel="stylesheet" type="text/css" />
    <link href="/resources/css/style.css"  rel="stylesheet" type="text/css"  />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    

</head>
<body>
    <header>
        <button class="back_btn"></button><span class="title">메뉴목록</span>
      </header>
      
      <div class="contents_wrap" id="contents_list">
        <div class="loading-container" id="loading_container">
          <div class="loading"></div>
          <div id="loading-text">loading</div>
        </div>
        <br />
        <br />
    </div>
      <script type="text/javascript" src="/resources/js/jquery-3.5.1.min.js"></script>
      <script type="text/javascript" src="/resources/js/handlebars-4.0.11.js"></script>
      <script type="text/javascript" src="/resources/js/common.js"></script>

      <script id="menuList" type="text/x-handlebars-template">
        <!-- 컨텐츠영역 -->
      
            {{#menuList}}
            <div class="round_box" name="food_box" data-food_name="{{name}}" data-food_location="{{location}}"
                 data-food_menutype="{{menuType}}" data-food_id="{{id}}">
              <p class="req_title" >
               {{name}}
               <span id="delete" data-food_id="{{id}}" style="float: right">
                <img src="/resources/images/delete.svg" width="20" height="20">
               </span>
              </p>
              <div class="req_dt_wrap">
                <span class="req_dt" >
                 {{location}}
                </span>
                <span class="req_dt" >
                 {{menuName}}
                </span> 
              </div>
            </div>
            {{/menuList}}
     
    </script>

    <script type="text/javascript">
        console.log('run!')
        $(function(){
          $('#loading_container').hide();

          var callback = ajaxConnect('POST', 'getAllMenu', {});
          $('#loading_container').show();
          if(callback.data !== undefined) {
            $('#loading_container').hide();
            var obj = callback.data;
            var source = $("#menuList").html();
            var template = Handlebars.compile(source);
            var res = {
                menuList : obj.data
            }; 

            var html = template(res);
            console.log(html)
            $("#contents_list").append(html);
          } else if(callback.error !== undefined) {
              console.log(callback.error);
              alert(callback.errMsg);
          }
        });

        
        $(document).on('click', 'div[name="food_box"]', function(e){
            e.preventDefault();
		        e.stopPropagation();
            
            var location = $(this).data('food_location');
            var name = $(this).data('food_name')
            var type = $(this).data('food_menutype')
            var id = $(this).data('food_id');
    
            window.location.href = 'lunch_menuDetail.html?name='+name+'&location='+location+'&id='+id+'&type='+type;
        });

        $(document).on('click', 'span[id="delete"]', function(e){
          e.preventDefault();
		      e.stopPropagation();
          //alert($(this).data('food_id'));

          var id = $(this).data('food_id');
          var msg = '삭제하시겠습니까?';
          var deleteParam = {};
          deleteParam = {"id" : id};

          if(confirm(msg) != 0) {
            var callback = ajaxConnect('POST', 'deleteMenu', deleteParam);
            console.log(deleteParam.id);
            console.log(JSON.stringify(callback));
            console.log(callback.xhr);

            if(callback.xhr == '204') {
             // $('#loading_container').hide();
              alert('삭제되었습니다.');
              window.location.reload()
            } else {
              alert('오류가 발생하였습니다.');
            }
          }
        });

          //좌측 상단 뒤로가기 버튼
          $('.back_btn').on('click', function(){
            location.href = 'lunch_main.html';
          });
    </script>

    
</body>
</html>
