<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main.html</title>

    <link href="/resources/css/common.css" rel="stylesheet" type="text/css" />
    <link href="/resources/css/style.css"  rel="stylesheet" type="text/css"  />
    <link href="/resources/css/miaps.css"  rel="stylesheet" type="text/css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
</head>
<body>
    <header>
        <button class="back_btn"></button><span class="title">메뉴 상세</span>
      </header>
      <div class="contents_wrap">
   
        <ul class="field_wrap">
         
            <li><span>음식점명</span>
              <input type="text" id="restaurant" name="nm" />
            </li>
            <li><span>주소</span>
                <textarea id="address" name="addr" ></textarea>
            </li>
            <li><span>종류</span>
                <!-- <input type="text" id="type" name="nm"/> -->
                <select id="typeName"></select>
            </li>
            
        </ul>
        <button type="button" class="main_btn" id="btn_save" style="float: left ; ">수정</button>
        <button type="button" class="main_btn" id="btn_delete" style="float: right;">삭제</button>
        <button type="button" class="main_btn" id="btn_add" style=" margin-top: 15px" >추가</button>
    </div>

    <script type="text/javascript" src="/resources/js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="/resources/js/handlebars-4.0.11.js"></script>
    <script type="text/javascript" src="/resources/js/common.js"></script>

    <script id="selectMenuType" type="text/x-handlebars-template">
      {{#menuType}}
      <option value="{{menuType}}">{{menuName}}</option>
      {{/menuType}}
    </script>

    <script type="text/javascript">

      var getParameters = function (paramName) { // 리턴값을 위한 변수 선언 
          var returnValue; // 현재 URL 가져오기 
          var url = location.href; // get 파라미터 값을 가져올 수 있는 ? 를 기점으로 slice 한 후 split 으로 나눔 
          var parameters = (url.slice(url.indexOf('?') + 1, url.length)).split('&'); // 나누어진 값의 비교를 통해 paramName 으로 요청된 데이터의 값만 
            for (var i = 0; i < parameters.length; i++) { 
              var varName = parameters[i].split('=')[0]; 
              if (varName.toUpperCase() == paramName.toUpperCase()) { 
                returnValue = parameters[i].split('=')[1]; 
                return decodeURIComponent(returnValue); } } 
      };

      $(function(){
        var callback = ajaxConnect('GET', 'getMenuType', '');
        //alert(JSON.stringify(callback));
        if(callback.data != undefined) {
          var obj = callback.data;
          var source = $("#selectMenuType").html();
          var template = Handlebars.compile(source);
          var res = {
              menuType : obj.data
          };
    
          var html = template(res);
          console.log(html)
          $("#typeName").append(html);
        }
        
        $('#restaurant').val(getParameters('name'));
        $('#address').val(getParameters('location'));
        $('#typeName').val(getParameters('type'));
      });
      
      $('#btn_save').on('click', function(){
         var msg = "수정하시겠습니까?";
         if (confirm(msg)!=0) {
            var p_address = $('#address').val();
            var p_name = $('#restaurant').val();
            var p_type = $('#typeName').val();
            var p_id = getParameters('id');
            
            if(p_address == '' || p_name == '' || p_type == '') {
                alert('내용을 입력해주세요.');
                return;
            }

            var modifyData = {};
            modifyData = {"id" : p_id, "location" : p_address, "menuType" : p_type, "name" : p_name};
            var callback = ajaxConnect('POST', 'modifyMenu', modifyData);
            console.log(JSON.stringify(callback))

            if(callback.xhr == '204') {
              alert('수정되었습니다.');
            } else if(callback.error != undefined) {
              alert(callback.errMsg);
            }
         }
      });
			
      $('#btn_delete').on('click', function(){
            var msg = "삭제하시겠습니까?";

            if (confirm(msg)!=0) { // Yes click
              var deleteData = {};
              deleteData = {"id" : getParameters('id')};
              var callback = ajaxConnect('POST', 'deleteMenu', deleteData);
              console.log(JSON.stringify(callback))

              if(callback.xhr == '204') {
                alert('삭제되었습니다.');
                location.href = 'lunch_allMenuList.html';
              } else if(callback.error != undefined) {
                alert(callback.errMsg);
              }
                 
            } else {
                // no click
            }
        });

        $('#btn_add').on('click', function(){
         
          var msg = "추가하시겠습니까?";
            if (confirm(msg)!=0) {
                 // Yes click
                  var addData = {};
                  addData = {"id" : getParameters('id')};
                  var callback = ajaxConnect('POST', 'visitMenu', addData);
                  console.log(JSON.stringify(callback));
                  
                  //성공
                  if(callback.data != undefined) {
                    alert('추가되었습니다.');
                  } else if(callback.error != undefined) { //실패
                    alert(callback.errMsg);
                  }
            } else {
                // no click
            }
        });

        // 58.181.28.53:11199/menu/getAllMenu(GET) // addMenu(POST)
    
      //좌측 상단 뒤로가기 버튼
      $('.back_btn').on('click', function(){
        window.history.back();
      });
    </script>

    
</body>
</html>
